<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cracker Pro Player - Zero Controls Loading</title>
    
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

    <style>
        :root {
            --primary-color: #00d2ff;
            --bg-color: #050505;
            --card-bg: #151515;
            --plyr-color-main: #00d2ff;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 0; color: white;
            display: flex; flex-direction: column; min-height: 100vh;
        }

        #player-container {
            width: 100%;
            background: #000;
            aspect-ratio: 16/9;
            position: sticky; top: 0; z-index: 1000;
            overflow: hidden;
        }

        /* আধুনিক লোডিং সিস্টেম */
        #loader-wrapper {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); /* লোড হওয়ার সময় পুরোপুরি কালো ব্যাকগ্রাউন্ড */
            backdrop-filter: blur(10px);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; display: none;
        }

        .spinner {
            width: 50px; height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* গুরুত্বপূর্ণ: লোডিং চলাকালীন কন্ট্রোল বাটন পুরোপুরি ভ্যানিশ */
        .force-hide-controls .plyr__controls, 
        .force-hide-controls .plyr__control--overlaid {
            display: none !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }

        .content-area { padding: 20px; flex: 1; }
        .section-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .back-home { font-size: 12px; color: var(--primary-color); text-decoration: none; border: 1px solid var(--primary-color); padding: 5px 12px; border-radius: 20px; }

        .suggested-list { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 15px; scrollbar-width: none; }
        .suggested-list::-webkit-scrollbar { display: none; }

        .suggest-card {
            flex: 0 0 110px; background: var(--card-bg);
            border-radius: 12px; padding: 15px 10px;
            text-align: center; cursor: pointer; border: 1px solid #222;
        }
        .suggest-card img { width: 45px; height: 45px; border-radius: 50%; margin-bottom: 8px; background: #fff; padding: 3px; }
        .suggest-card .name { font-size: 11px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .ad-space { margin-top: 20px; text-align: center; background: #111; padding: 10px; border-radius: 8px; border: 1px dashed #333; }
    </style>
</head>
<body>

    <div id="player-container" class="force-hide-controls">
        <div id="loader-wrapper">
            <div class="spinner"></div>
            <div style="margin-top:15px; font-size:12px; letter-spacing:2px; color:var(--primary-color); font-weight:bold;">LOADING STREAM</div>
        </div>
        <video id="player" playsinline controls crossorigin></video>
    </div>

    <div class="content-area">
        <div class="section-title">
            <span>Suggested Channels</span>
            <a href="index.html" class="back-home">Back to Home</a>
        </div>
        <div class="suggested-list" id="suggested-container"></div>
        <div class="ad-space">
            <script async="async" data-cfasync="false" src="https://pl26377079.effectivegatecpm.com/cdeccdd75d3e2e6916a42ce9653cfb08/invoke.js"></script>
            <div id="container-cdeccdd75d3e2e6916a42ce9653cfb08"></div>
        </div>
    </div>

<script>
    const M3U_URL = 'https://raw.githubusercontent.com/rsfjbd/Best-IPTV-/refs/heads/main/Test.m3u';
    const video = document.getElementById('player');
    const loaderWrapper = document.getElementById('loader-wrapper');
    const playerContainer = document.getElementById('player-container');

    const player = new Plyr(video, { 
        hideControls: true, 
        autoplay: true,
        muted: true,
        controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen']
    });

    let hls = new Hls();

    function playStream(url) {
        // লোডিং শুরু হওয়ার সাথে সাথে কন্ট্রোল জিরো করে দেওয়া
        playerContainer.classList.add('force-hide-controls');
        loaderWrapper.style.display = 'flex';

        if (Hls.isSupported()) {
            hls.destroy();
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            
            // যখন ভিডিও প্লে হওয়ার জন্য একদম তৈরি (Buffered and Ready)
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                video.play();
            });

            // ভিডিওর ডাটা যখন প্রথম ফ্রেম দেখাবে তখন কন্ট্রোল ফিরিয়ে আনা
            video.onplaying = () => {
                setTimeout(() => {
                    loaderWrapper.style.display = 'none';
                    playerContainer.classList.remove('force-hide-controls');
                }, 1000); // ১ সেকেন্ড অতিরিক্ত সময় রাখা হয়েছে স্মুথনেসের জন্য
            };
        }
    }

    const urlParams = new URLSearchParams(window.location.search);
    const initialUrl = urlParams.get('m3u');
    if (initialUrl) playStream(initialUrl);

    fetch(M3U_URL).then(res => res.text()).then(data => {
        const lines = data.split('\n');
        let channels = [];
        let currentChan = {};
        lines.forEach(line => {
            if (line.startsWith('#EXTINF')) {
                currentChan = { 
                    name: line.split(',')[1] || "Unknown", 
                    logo: line.match(/tvg-logo="([^"]*)"/)?.[1] || "" 
                };
            } else if (line.trim().startsWith('http')) {
                currentChan.url = line.trim();
                channels.push(currentChan);
                currentChan = {};
            }
        });
        const shuffled = channels.sort(() => 0.5 - Math.random()).slice(0, 15);
        document.getElementById('suggested-container').innerHTML = shuffled.map(ch => `
            <div class="suggest-card" onclick="playStream('${ch.url}')">
                <img src="${ch.logo}" onerror="this.src='https://via.placeholder.com/45'">
                <div class="name">${ch.name}</div>
            </div>
        `).join('');
    });

    player.on('enterfullscreen', () => screen.orientation.lock('landscape').catch(() => {}));
    player.on('exitfullscreen', () => screen.orientation.unlock());
    document.body.addEventListener('click', () => { player.muted = false; }, { once: true });
</script>
</body>
</html>
