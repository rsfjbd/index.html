<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRACKER PRO IPTV - Ultimate</title>
    
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

    <style>
        :root {
            --primary-color: #00d2ff;
            --bg-color: #050505;
            --card-bg: #111;
            --sidebar-bg: #0a0a0a;
            --plyr-color-main: #00d2ff;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 0; color: white;
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }

        /* ‡¶π‡ßá‡¶°‡¶æ‡¶∞ */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 15px; background: #111; border-bottom: 1px solid #222; z-index: 1000;
        }
        .menu-btn { font-size: 24px; cursor: pointer; color: var(--primary-color); }
        .app-title { font-size: 18px; font-weight: bold; letter-spacing: 1px; }

        /* ‡¶∏‡¶æ‡¶á‡¶°‡¶¨‡¶æ‡¶∞ ‡¶Æ‡ßá‡¶®‡ßÅ */
        .sidebar {
            position: fixed; top: 0; left: -280px; width: 280px; height: 100%;
            background: var(--sidebar-bg); transition: 0.3s; z-index: 2000;
            border-right: 1px solid #222; padding-top: 20px;
        }
        .sidebar.active { left: 0; }
        .sidebar-item { padding: 15px 25px; border-bottom: 1px solid #1a1a1a; cursor: pointer; display: flex; align-items: center; gap: 15px; }
        .sidebar-item:hover { background: #1a1a1a; color: var(--primary-color); }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1900; display: none; }
        .overlay.active { display: block; }

        /* ‡¶™‡ßç‡¶≤‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® */
        #player-container { width: 100%; background: #000; aspect-ratio: 16/9; position: relative; flex-shrink: 0; }
        #loader-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
        .spinner { width: 45px; height: 45px; border: 5px solid rgba(255,255,255,0.1); border-top: 5px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .force-hide-controls .plyr__controls { display: none !important; }

        /* ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶è‡¶∞‡¶ø‡ßü‡¶æ */
        .search-area { padding: 10px; background: #0a0a0a; display: flex; justify-content: center; border-bottom: 1px solid #222; }
        .search-input { width: 90%; max-width: 500px; padding: 10px; border-radius: 20px; border: 1px solid #333; background: #1a1a1a; color: #fff; outline: none; text-align: center; }

        /* ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶ì ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü */
        .category-scroll { display: flex; overflow-x: auto; gap: 15px; padding: 10px 15px; scrollbar-width: none; background: #0a0a0a; }
        .cat-tab { cursor: pointer; white-space: nowrap; color: #888; font-size: 14px; padding: 5px 10px; border-radius: 15px; }
        .cat-tab.active { color: #000; background: var(--primary-color); }

        .content-area { flex: 1; overflow-y: auto; padding: 15px; }
        .channels-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        /* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° */
        .channel-card {
            background: var(--card-bg); border-radius: 12px; padding: 10px;
            text-align: center; border: 1px solid #222; cursor: pointer;
            height: 100px; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .channel-card img { width: 35px; height: 35px; border-radius: 50%; margin-bottom: 5px; background: #fff; padding: 2px; }
        .channel-name { font-size: 10px; font-weight: 600; line-height: 1.2; }
        .fav-btn { position: absolute; top: 5px; right: 5px; font-size: 14px; color: #555; }
        .fav-btn.active { color: #ff4d4d; }

        /* ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶™‡ßç‡¶≤‡ßá‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶´‡¶∞‡ßç‡¶Æ (Modal) */
        #playlist-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #1a1a1a; width: 85%; max-width: 400px; padding: 20px;
            border-radius: 15px; border: 1px solid var(--primary-color); z-index: 3000; display: none;
        }
        .tab-btns { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab-btns button { flex: 1; padding: 8px; border: none; border-radius: 5px; cursor: pointer; background: #333; color: #fff; }
        .tab-btns button.active { background: var(--primary-color); color: #000; font-weight: bold; }
        .input-group { margin-bottom: 10px; }
        .input-group label { display: block; font-size: 11px; color: #888; margin-bottom: 4px; }
        .input-group input { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #333; background: #000; color: #fff; box-sizing: border-box; }
        .save-btn { width: 100%; padding: 12px; background: var(--primary-color); border: none; border-radius: 5px; font-weight: bold; margin-top: 10px; cursor: pointer; }

    </style>
</head>
<body>

    <div class="overlay" onclick="toggleMenu()"></div>
    <div class="sidebar" id="sidebar">
        <div style="padding: 20px; font-size: 20px; font-weight: bold; color: var(--primary-color); border-bottom: 1px solid #222;">CRACKER PRO</div>
        <div class="sidebar-item" onclick="filterCat(null, 'All'); toggleMenu();">üè† Home</div>
        <div class="sidebar-item" onclick="showFavorites(); toggleMenu();">‚ù§Ô∏è Favorites</div>
        <div class="sidebar-item" onclick="alert('Settings coming soon!');">‚öôÔ∏è Settings</div>
        <div class="sidebar-item" onclick="location.reload();" style="color: #ff4d4d;">üö™ Reload App</div>
    </div>

    <header>
        <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
        <div class="app-title">CRACKER PRO</div>
        <div class="menu-btn" onclick="toggleModal()">+</div>
    </header>

    <div id="player-container" class="force-hide-controls">
        <div id="loader-wrapper">
            <div class="spinner"></div>
            <div style="color:var(--primary-color); font-size:12px; margin-top:10px; font-weight:bold;">BUFFERING...</div>
        </div>
        <video id="player" playsinline controls crossorigin></video>
    </div>

    <div class="search-area">
        <input type="text" id="search-box" class="search-input" placeholder="üîç Search channel..." oninput="handleSearch()">
    </div>
    <div class="category-scroll" id="category-tabs"></div>

    <div class="content-area">
        <div class="channels-grid" id="channels-container"></div>
    </div>

    <div id="playlist-modal">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0;">Add Playlist</h3>
            <span onclick="toggleModal()" style="cursor:pointer; color:red; font-size:24px;">&times;</span>
        </div>
        <div class="tab-btns">
            <button id="btn-m3u" class="active" onclick="switchTab('m3u')">M3U Link</button>
            <button id="btn-xtream" onclick="switchTab('xtream')">Xtream API</button>
        </div>
        <div id="m3u-form">
            <div class="input-group">
                <label>Playlist URL</label>
                <input type="text" id="m3u-url-input" placeholder="http://server.com/playlist.m3u">
            </div>
        </div>
        <div id="xtream-form" style="display:none;">
            <div class="input-group"><label>Host URL</label><input type="text" id="xh" placeholder="http://host:8080"></div>
            <div class="input-group"><label>Username</label><input type="text" id="xu" placeholder="User"></div>
            <div class="input-group"><label>Password</label><input type="password" id="xp" placeholder="Pass"></div>
        </div>
        <button class="save-btn" onclick="saveNewPlaylist()">LOAD NOW</button>
    </div>

<script>
    const DEFAULT_M3U = 'https://raw.githubusercontent.com/rsfjbd/Best-IPTV-/refs/heads/main/Ayna.m3u';
    const DEFAULT_LOGO = 'https://cdn-icons-png.flaticon.com/512/3585/3585863.png';

    const video = document.getElementById('player');
    const loader = document.getElementById('loader-wrapper');
    const playerContainer = document.getElementById('player-container');
    const player = new Plyr(video, { hideControls: true, autoplay: true, muted: true });

    let hls = new Hls();
    let allChannels = [];
    let favorites = JSON.parse(localStorage.getItem('favs')) || [];
    let currentCat = 'All';

    function toggleMenu() {
        document.getElementById('sidebar').classList.toggle('active');
        document.querySelector('.overlay').classList.toggle('active');
    }

    function toggleModal() {
        const m = document.getElementById('playlist-modal');
        m.style.display = m.style.display === 'block' ? 'none' : 'block';
    }

    function switchTab(type) {
        document.getElementById('m3u-form').style.display = type === 'm3u' ? 'block' : 'none';
        document.getElementById('xtream-form').style.display = type === 'xtream' ? 'block' : 'none';
        document.getElementById('btn-m3u').classList.toggle('active', type === 'm3u');
        document.getElementById('btn-xtream').classList.toggle('active', type === 'xtream');
    }

    function loadStream(url) {
        playerContainer.classList.add('force-hide-controls');
        loader.style.display = 'flex';
        if (Hls.isSupported()) {
            hls.destroy();
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                video.play();
                video.onplaying = () => {
                    setTimeout(() => {
                        loader.style.display = 'none';
                        playerContainer.classList.remove('force-hide-controls');
                    }, 1000);
                };
            });
        }
    }

    function fetchM3U(url) {
        fetch(url).then(res => res.text()).then(data => {
            const lines = data.split('\n');
            allChannels = [];
            let cats = new Set(['All']);
            let temp = {};

            lines.forEach(line => {
                if (line.startsWith('#EXTINF')) {
                    temp = {
                        name: line.split(',')[1] || "Unknown",
                        logo: line.match(/tvg-logo="([^"]*)"/)?.[1] || DEFAULT_LOGO,
                        group: line.match(/group-title="([^"]*)"/)?.[1] || "Others"
                    };
                    cats.add(temp.group);
                } else if (line.trim().startsWith('http')) {
                    temp.url = line.trim();
                    allChannels.push(temp);
                }
            });

            document.getElementById('category-tabs').innerHTML = Array.from(cats).map(c => 
                `<div class="cat-tab" onclick="filterCat(this, '${c}')">${c}</div>`).join('');
            document.querySelector('.cat-tab').classList.add('active');
            renderChannels('All');
        }).catch(() => alert("Invalid Playlist URL"));
    }

    function renderChannels(cat, search = '', list = allChannels) {
        const container = document.getElementById('channels-container');
        let filtered = cat === 'All' ? list : list.filter(c => c.group === cat);
        if(search) filtered = filtered.filter(c => c.name.toLowerCase().includes(search.toLowerCase()));

        container.innerHTML = filtered.map(ch => {
            const isFav = favorites.some(f => f.url === ch.url);
            return `
                <div class="channel-card">
                    <span class="fav-btn ${isFav ? 'active' : ''}" onclick="toggleFav(event, '${ch.url}')">‚ù§Ô∏è</span>
                    <div style="width:100%" onclick="loadStream('${ch.url}')">
                        <img src="${ch.logo}" onerror="this.src='${DEFAULT_LOGO}'">
                        <div class="channel-name">${ch.name}</div>
                    </div>
                </div>`;
        }).join('');
    }

    function filterCat(el, cat) {
        currentCat = cat;
        if(el) {
            document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }
        renderChannels(cat);
    }

    function handleSearch() {
        renderChannels(currentCat, document.getElementById('search-box').value);
    }

    function toggleFav(e, url) {
        e.stopPropagation();
        const chan = allChannels.find(c => c.url === url);
        const idx = favorites.findIndex(f => f.url === url);
        if(idx > -1) favorites.splice(idx, 1);
        else favorites.push(chan);
        localStorage.setItem('favs', JSON.stringify(favorites));
        renderChannels(currentCat, document.getElementById('search-box').value);
    }

    function showFavorites() {
        currentCat = 'Fav';
        document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
        renderChannels('All', '', favorites);
    }

    function saveNewPlaylist() {
        const isM3U = document.getElementById('m3u-form').style.display !== 'none';
        let url = "";
        if(isM3U) url = document.getElementById('m3u-url-input').value;
        else {
            const h = document.getElementById('xh').value, u = document.getElementById('xu').value, p = document.getElementById('xp').value;
            if(h && u && p) url = `${h}/get.php?username=${u}&password=${p}&type=m3u_plus&output=ts`;
        }
        if(url) { fetchM3U(url); toggleModal(); }
    }

    fetchM3U(DEFAULT_M3U);
    player.on('enterfullscreen', () => screen.orientation.lock('landscape').catch(() => {}));
    player.on('exitfullscreen', () => screen.orientation.unlock());
    document.body.addEventListener('click', () => { player.muted = false; }, { once: true });
</script>
</body>
</html>
